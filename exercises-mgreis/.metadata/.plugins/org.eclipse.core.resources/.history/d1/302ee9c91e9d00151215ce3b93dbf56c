package loadxml;


import java.io.StringReader;
import java.nio.charset.StandardCharsets;

import javax.naming.NamingException;
import javax.xml.transform.stream.StreamSource;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.bind.Unmarshaller;


import xml.XmlHelper;
import xml.Report;
import xml.ObjectFactory;

/**
 *
 * @author mgreis
 */
public class AddingSmartphones implements Runnable {

   

    // data
    
    private volatile Report report;

    public PriceKeeper(Report report) {
    	this.report=report;
    }

    @Override
    public void run() {

       
            // receive data from topic
            while (true) {
                String xml;
                try {
                    
                    xml = new String(receive(), StandardCharsets.UTF_8);
                } catch (Exception ex) {
                    System.out.println("ERROR: Failed to receive data from file.");
                
                    continue; // try again
                }

                // validate message
                // @xxx doesn't check timestamp
                try {
                    XmlHelper.validate(new StreamSource(new StringReader(xml)));
                } catch (Exception ex) {
                    System.out.println("ERROR: Failed to validate.");
                   
                    continue; // try again
                }

                // replace data
                
                JAXBContext context;
				try {
					context = JAXBContext.newInstance(Report.class, ObjectFactory.class);
                Unmarshaller unmarshaller;
				
					unmarshaller = context.createUnmarshaller();
				
                StringReader reader = new StringReader(xml);
               
					report = (Report) unmarshaller.unmarshal(reader);
				} catch (JAXBException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
            }
        
    }

   

    private byte[] receive() throws Exception {
        byte[] array=null; 
        return array;
        	
    }

 

}
